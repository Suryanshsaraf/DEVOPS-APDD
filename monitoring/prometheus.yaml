# ──────────────────────────────────────────────────
# Prometheus Configuration
# ──────────────────────────────────────────────────
# Scrape config for the ML Prediction API.
# Deploy as a ConfigMap in Kubernetes or volume-mount
# in Docker Compose.
# ──────────────────────────────────────────────────

global:
  scrape_interval: 15s          # How often to scrape targets
  evaluation_interval: 15s      # How often to evaluate rules
  scrape_timeout: 10s           # Timeout per scrape

  external_labels:
    cluster: "ml-prediction-cluster"
    environment: "production"

# ── Alert Manager Configuration (optional) ───────
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#             - "alertmanager:9093"

# ── Rule Files ───────────────────────────────────
rule_files:
  - "/etc/prometheus/alert-rules.yml"

# ── Scrape Configuration ────────────────────────
scrape_configs:
  # ── Prometheus Self-Monitoring ─────────────────
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]
        labels:
          service: "prometheus"

  # ── ML Prediction API ─────────────────────────
  - job_name: "ml-prediction-api"
    metrics_path: "/metrics"
    scrape_interval: 10s

    # For Docker Compose (local dev)
    static_configs:
      - targets: ["ml-api:8000"]
        labels:
          service: "ml-prediction-api"
          environment: "development"

    # For Kubernetes – uncomment and use service discovery:
    # kubernetes_sd_configs:
    #   - role: pod
    #     namespaces:
    #       names:
    #         - ml-production
    # relabel_configs:
    #   - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
    #     action: keep
    #     regex: true
    #   - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
    #     action: replace
    #     target_label: __metrics_path__
    #     regex: (.+)
    #   - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
    #     action: replace
    #     regex: ([^:]+)(?::\d+)?;(\d+)
    #     replacement: $1:$2
    #     target_label: __address__
    #   - source_labels: [__meta_kubernetes_namespace]
    #     action: replace
    #     target_label: kubernetes_namespace
    #   - source_labels: [__meta_kubernetes_pod_name]
    #     action: replace
    #     target_label: kubernetes_pod_name
